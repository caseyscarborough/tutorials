<!DOCTYPE html><html><head><title>Using Dependency Injection to Write Testable Code</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Using Dependency Injection to Write Testable Code"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Using Dependency Injection to Write Testable Code</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>This tutorial will walk you through using Dependency Injection to write more easily testable code, as well as how to test the newly refactored code using JUnit and Mockito, a mocking framework.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Using Dependency Injection" class="chapter"><div data-title="What Untestable Code Looks Like" data-file="src/main/java/com/caseyscarborough/tutorial/testing/HardResource.java" data-highlight="9-18" class="step"><h2 id="what-untestable-code-looks-like">What Untestable Code Looks Like</h2>
<p>To begin, we&#39;ll show what untestable code looks like. Take a look at the method on the right. This is a standard JAX-RS <code>@GET</code> method, which retrieves some content from the database and returns it to the user.</p>
<p>This method is hard to test, because we can&#39;t actually test it without executing our database method. This is because the method will always execute <code>new Dao().getDatabaseContent()</code>.</p>
<p>So how can we fix this? By using dependency injection.</p>
</div><div data-title="What is Dependency Injection?" data-file="src/main/java/com/caseyscarborough/tutorial/testing/HardResource.java" data-highlight="9-18" class="step"><h2 id="what-is-dependency-injection-">What is Dependency Injection?</h2>
<p>According to <a href="https://en.wikipedia.org/wiki/Dependency_injection">Wikipedia</a>, dependency injection is a software design pattern that implements inversion of control for resolving dependencies. In a nutshell, this means that any dependencies that a class has, should be provided, or &quot;passed in&quot;, by the caller of the class.</p>
<p>Classes should not know the concrete type of their dependencies as well. Calls should not be static. Let&#39;s take a look at this class refactored to use dependency injection.</p>
</div><div data-title="Refactoring to Use Dependency Injection" data-file="src/main/java/com/caseyscarborough/tutorial/testing/EasyResource.java" data-highlight="9-25" class="step"><h2 id="refactoring-to-use-dependency-injection">Refactoring to Use Dependency Injection</h2>
<p>The class has now been refactored to use dependency injection. The DAO class gets passed into this class from its constructor. For testing, we can pass in a &quot;mock&quot; version of our DAO class that doesn&#39;t actually execute tests on the database, and we can verify that this class itself performs it&#39;s duty by calling the DAO and returning its content.</p>
</div></div><div data-title="Mocking a Dependency for Testing" class="chapter"><div data-title="Testing Using Manual Mocking" data-file="src/test/java/com/caseyscarborough/tutorial/testing/MockDao.java" data-highlight="5-11" class="step"><h2 id="testing-using-manual-mocking">Testing Using Manual Mocking</h2>
<p>To begin testing our Resource class, we&#39;ll want to create a &quot;mock&quot; instance of our DAO class, one that doesn&#39;t actually execute any queries on the database.</p>
<p>On the right, we&#39;ve created a new subclass of <code>Dao</code>, and overriden the <code>getDatabaseContent</code> method so that is just returns a static string, and it doesn&#39;t <em>actually</em> execute anything on the database.</p>
<p>Now we can create our JUnit test to test our Resource method, and use this mock class for our DAO.</p>
</div><div data-title="Using our Mock Class in a Test" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceTest.java" data-highlight="12-24" class="step"><h2 id="using-our-mock-class-in-a-test">Using our Mock Class in a Test</h2>
<p>Now we&#39;ve created our JUnit test, which creates a new instance of our <code>MockEasyToTestDao</code> and passes it into our resource class.</p>
<p>Once we&#39;ve created our resource instance, we can execute the method and ensure that the content we retrieved was the content returned by our mock DAO class, without actually hitting the <em>real</em> database.</p>
<p>This has correctly tested the functionality of our resource class, without testing the functionality of the DAO, which is a part of the definition of a unit test.</p>
</div><div data-title="Completion" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceTest.java" data-highlight="0" class="step"><h2 id="completion">Completion</h2>
<p>You&#39;ve successfully seen how to refactor a class to use dependency injection, and how to write a mock instance of your class.</p>
<p>There&#39;s just one problem. Writing these manual mock classes is a pain, and will quickly bloat your code base if you&#39;d like to test things like what happens when the <code>Dao</code> throws an exception, or when it returns different content. This is where <a href="http://mockito.org/">Mockito</a> comes into play.</p>
<p>In the next section, we&#39;ll learn how to write tests for our resource class using Mockito to mock our <code>Dao</code> class.</p>
</div></div><div data-title="Testing Using Mockito for Mocking Dependencies" class="chapter"><div data-title="Including Mockito In Your Project" data-file="build.gradle" data-highlight="16" class="step"><h2 id="including-mockito-in-your-project">Including Mockito In Your Project</h2>
<p>If you&#39;re using Gradle, you can install Mockito into your project by adding the dependency on the right to your <code>build.gradle</code> file.</p>
<p>Otherwise, you can grab the latest version of the jar from <a href="http://mvnrepository.com/artifact/org.mockito/mockito-core/1.10.19">Maven Central</a>.</p>
</div><div data-title="Setting Up Your Test for Mockito" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-highlight="21-28" class="step"><h2 id="setting-up-your-test-for-mockito">Setting Up Your Test for Mockito</h2>
<p>We&#39;ve now moved our resource and DAO classes to be fields, and we&#39;ve created a &quot;setup&quot; method where we can initialize these classes before every test is run.</p>
<p>The first thing we want to do is mock our <code>Dao</code> instance, which is done on line 26 by calling <code>mock(Dao.class)</code>.</p>
<p>Afterwards, we pass this mock instance into our resource class using dependency injection. We&#39;re now ready to start mocking.</p>
</div><div data-title="Writing a Test Using Mockito" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-highlight="30-37" class="step"><h2 id="writing-a-test-using-mockito">Writing a Test Using Mockito</h2>
<p>We&#39;ve rewritten our previous test using Mockito now, and you can see it&#39;s much simpler than writing a manually mocked class.</p>
<p>The first line of this method tells our &quot;mock&quot; instance what to return when the method is called. Now we can call our resource method and ensure that it returns whatever the <code>Dao</code> returns.</p>
</div><div data-title="Verifying Methods are Called" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-highlight="40-44" class="step"><h2 id="verifying-methods-are-called">Verifying Methods are Called</h2>
<p>Many times, you&#39;d like to ensure that a method is actually called a certain number of times. You can do this with Mockito&#39;s <code>verify</code> method.</p>
<p>This test checks to make sure that the resource method actually calls the DAO method exactly one time.</p>
</div><div data-title="Mocking an Error" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-highlight="19-20,46-53" class="step"><h2 id="mocking-an-error">Mocking an Error</h2>
<p>In this last example, we&#39;ll show how you can mock an exception being thrown from your <code>Dao</code> class.</p>
<p>The first line of this method tells the mock instance to throw a <code>RuntimeException</code> with the message &quot;Database Error&quot; when the DAO method is called.</p>
<p>Since we&#39;re not catching the exception in our resource method, we expect that this method will be thrown into our test, which we account for.</p>
<p>Running this test will show that it passes, and we receive the expected results.</p>
</div><div data-title="Conclusion" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-highlight="0" class="step"><h2 id="conclusion">Conclusion</h2>
<p>The following are good resources on these topics:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a></li>
<li><a href="http://www.martinfowler.com/articles/injection.html">Inversion of Control Containers and the Dependency Injection pattern - Martin Fowler</a></li>
<li><a href="http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html">Mockito Documentation</a></li>
</ul>
<p>That&#39;s all for now. Thanks for reading!</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="src/main/java/com/caseyscarborough/tutorial/testing/HardResource.java" data-mode="java">cGFja2FnZSBjb20uY2FzZXlzY2FyYm9yb3VnaC50dXRvcmlhbC50ZXN0aW5nOwoKaW1wb3J0IGNvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcuZGFvLkRhbzsKCmltcG9ydCBqYXZheC53cy5ycy5HRVQ7CmltcG9ydCBqYXZheC53cy5ycy5QYXRoOwppbXBvcnQgamF2YXgud3MucnMuY29yZS5SZXNwb25zZTsKCkBQYXRoKCIvaGFyZHRvdGVzdCIpCnB1YmxpYyBjbGFzcyBIYXJkUmVzb3VyY2UgewoKICAgIEBHRVQKICAgIHB1YmxpYyBSZXNwb25zZSBnZXREYXRhYmFzZUNvbnRlbnQoKSB7CiAgICAgICAgU3RyaW5nIGNvbnRlbnQgPSBuZXcgRGFvKCkuZ2V0RGF0YWJhc2VDb250ZW50KCk7CiAgICAgICAgcmV0dXJuIFJlc3BvbnNlLm9rKGNvbnRlbnQpLmJ1aWxkKCk7CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/caseyscarborough/tutorial/testing/EasyResource.java" data-mode="java">cGFja2FnZSBjb20uY2FzZXlzY2FyYm9yb3VnaC50dXRvcmlhbC50ZXN0aW5nOwoKaW1wb3J0IGNvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcuZGFvLkRhbzsKCmltcG9ydCBqYXZheC53cy5ycy5HRVQ7CmltcG9ydCBqYXZheC53cy5ycy5QYXRoOwppbXBvcnQgamF2YXgud3MucnMuY29yZS5SZXNwb25zZTsKCkBQYXRoKCIvZWFzeXRvdGVzdCIpCnB1YmxpYyBjbGFzcyBFYXN5UmVzb3VyY2UgewoKICAgIHByaXZhdGUgRGFvIGRhbzsKCiAgICBwdWJsaWMgRWFzeVJlc291cmNlKERhbyBkYW8pIHsKICAgICAgICB0aGlzLmRhbyA9IGRhbzsKICAgIH0KCiAgICBAR0VUCiAgICBwdWJsaWMgUmVzcG9uc2UgZ2V0RGF0YWJhc2VDb250ZW50KCkgewogICAgICAgIFN0cmluZyBjb250ZW50ID0gZGFvLmdldERhdGFiYXNlQ29udGVudCgpOwogICAgICAgIHJldHVybiBSZXNwb25zZS5vayhjb250ZW50KS5idWlsZCgpOwogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="src/test/java/com/caseyscarborough/tutorial/testing/MockDao.java" data-mode="java">cGFja2FnZSBjb20uY2FzZXlzY2FyYm9yb3VnaC50dXRvcmlhbC50ZXN0aW5nOwoKaW1wb3J0IGNvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcuZGFvLkRhbzsKCnB1YmxpYyBjbGFzcyBNb2NrRGFvIGV4dGVuZHMgRGFvIHsKCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGF0YWJhc2VDb250ZW50KCkgewogICAgICAgIHJldHVybiAiSGVsbG8hIjsKICAgIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceTest.java" data-mode="java">cGFja2FnZSBjb20uY2FzZXlzY2FyYm9yb3VnaC50dXRvcmlhbC50ZXN0aW5nOwoKaW1wb3J0IGNvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcuZGFvLkRhbzsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwoKaW1wb3J0IGphdmF4LndzLnJzLmNvcmUuUmVzcG9uc2U7CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxzOwoKcHVibGljIGNsYXNzIEVhc3lSZXNvdXJjZVRlc3QgewoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0Q29udGVudCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSBvdXIgIm1vY2siIGRhbyBpbnN0YW5jZQogICAgICAgIERhbyBkYW8gPSBuZXcgTW9ja0RhbygpOwoKICAgICAgICAvLyBQYXNzIG91ciBtb2NrIGluc3RhbmNlIGludG8gb3VyIHJlc291cmNlIHVzaW5nIGRlcGVuZGVuY3kgaW5qZWN0aW9uCiAgICAgICAgRWFzeVJlc291cmNlIHJlc291cmNlID0gbmV3IEVhc3lSZXNvdXJjZShkYW8pOwoKICAgICAgICAvLyBUZXN0IHRoYXQgb3VyIGNvbnRlbnQgaXMgcmV0cmlldmVkIGZyb20gdGhlIERBTy4KICAgICAgICBSZXNwb25zZSByZXNwb25zZSA9IHJlc291cmNlLmdldERhdGFiYXNlQ29udGVudCgpOwogICAgICAgIFN0cmluZyBkYXRhYmFzZUNvbnRlbnQgPSByZXNwb25zZS5nZXRFbnRpdHkoKS50b1N0cmluZygpOwogICAgICAgIGFzc2VydEVxdWFscygiSGVsbG8hIiwgZGF0YWJhc2VDb250ZW50KTsKICAgIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="build.gradle" data-mode="text">Z3JvdXAgJ2NvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcnCnZlcnNpb24gJzEuMC1TTkFQU0hPVCcKCmFwcGx5IHBsdWdpbjogJ2phdmEnCgpzb3VyY2VDb21wYXRpYmlsaXR5ID0gMS41CgpyZXBvc2l0b3JpZXMgewogICAgbWF2ZW5DZW50cmFsKCkKfQoKZGVwZW5kZW5jaWVzIHsKICAgIGNvbXBpbGUgJ2phdmF4LndzLnJzOmphdmF4LndzLnJzLWFwaToyLjAuMScKCiAgICB0ZXN0Q29tcGlsZSAnanVuaXQ6anVuaXQ6NC4xMScKICAgIHRlc3RDb21waWxlICdvcmcubW9ja2l0bzptb2NraXRvLWNvcmU6MS4xMC4xOScKCiAgICB0ZXN0Q29tcGlsZSAnb3JnLmdsYXNzZmlzaC5qZXJzZXkuY29yZTpqZXJzZXktY29tbW9uOjIuMjIuMicKfQo=</textarea>
<textarea class="saurus-file" data-file="src/test/java/com/caseyscarborough/tutorial/testing/EasyResourceMockitoTest.java" data-mode="java">cGFja2FnZSBjb20uY2FzZXlzY2FyYm9yb3VnaC50dXRvcmlhbC50ZXN0aW5nOwoKaW1wb3J0IGNvbS5jYXNleXNjYXJib3JvdWdoLnR1dG9yaWFsLnRlc3RpbmcuZGFvLkRhbzsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuUnVsZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLmp1bml0LnJ1bGVzLkV4cGVjdGVkRXhjZXB0aW9uOwoKaW1wb3J0IGphdmF4LndzLnJzLmNvcmUuUmVzcG9uc2U7CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxzOwppbXBvcnQgc3RhdGljIG9yZy5tb2NraXRvLk1vY2tpdG8ubW9jazsKaW1wb3J0IHN0YXRpYyBvcmcubW9ja2l0by5Nb2NraXRvLnRpbWVzOwppbXBvcnQgc3RhdGljIG9yZy5tb2NraXRvLk1vY2tpdG8udmVyaWZ5OwppbXBvcnQgc3RhdGljIG9yZy5tb2NraXRvLk1vY2tpdG8ud2hlbjsKCnB1YmxpYyBjbGFzcyBFYXN5UmVzb3VyY2VNb2NraXRvVGVzdCB7CgogICAgQFJ1bGUKICAgIHB1YmxpYyBFeHBlY3RlZEV4Y2VwdGlvbiBleHBlY3RlZEV4Y2VwdGlvbiA9IEV4cGVjdGVkRXhjZXB0aW9uLm5vbmUoKTsKCiAgICBwcml2YXRlIERhbyBkYW87CiAgICBwcml2YXRlIEVhc3lSZXNvdXJjZSByZXNvdXJjZTsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGRhbyA9IG1vY2soRGFvLmNsYXNzKTsKICAgICAgICByZXNvdXJjZSA9IG5ldyBFYXN5UmVzb3VyY2UoZGFvKTsKICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEdldERhdGFiYXNlQ29udGVudCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHdoZW4oZGFvLmdldERhdGFiYXNlQ29udGVudCgpKS50aGVuUmV0dXJuKCJIZWxsbyEiKTsKCiAgICAgICAgUmVzcG9uc2UgcmVzcG9uc2UgPSByZXNvdXJjZS5nZXREYXRhYmFzZUNvbnRlbnQoKTsKICAgICAgICBTdHJpbmcgZGF0YWJhc2VDb250ZW50ID0gcmVzcG9uc2UuZ2V0RW50aXR5KCkudG9TdHJpbmcoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkhlbGxvISIsIGRhdGFiYXNlQ29udGVudCk7CiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RHZXREYXRhYmFzZUNvbnRlbnRDYWxsc0RhbygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHJlc291cmNlLmdldERhdGFiYXNlQ29udGVudCgpOwogICAgICAgIHZlcmlmeShkYW8sIHRpbWVzKDEpKS5nZXREYXRhYmFzZUNvbnRlbnQoKTsKICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEdldERhdGFiYXNlQ29udGVudFdoZW5EYW9UaHJvd3NFeGNlcHRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB3aGVuKGRhby5nZXREYXRhYmFzZUNvbnRlbnQoKSkudGhlblRocm93KG5ldyBSdW50aW1lRXhjZXB0aW9uKCJEYXRhYmFzZSBFcnJvciIpKTsKCiAgICAgICAgZXhwZWN0ZWRFeGNlcHRpb24uZXhwZWN0KFJ1bnRpbWVFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4cGVjdGVkRXhjZXB0aW9uLmV4cGVjdE1lc3NhZ2UoIkRhdGFiYXNlIEVycm9yIik7CiAgICAgICAgcmVzb3VyY2UuZ2V0RGF0YWJhc2VDb250ZW50KCk7CiAgICB9Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/caseyscarborough/tutorials/tree/gh-pages/dependency-injection" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>